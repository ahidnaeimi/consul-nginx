# Consul + Nginx + Consul Template (Dynamic Service Discovery)

ุงู ูพุฑูฺู ฺฉ ููููู ุณุงุฏู ุงุฒ ุงุณุชูุงุฏู ุชุฑฺฉุจ **Nginx**, **Consul** ู **Consul Template** ุงุณุช ุจุฑุง ุญู ูุดฺฉูุงุช ุฑุงุฌ ฺฉู ุฏุฑ ูุญุทโูุง ุฏุงฺฉุฑ ุจุง ุขู ููุงุฌู ูโุดูู:

---

## ๐งฉ ูุดฺฉู ุงุตู

ููุช ุงุฒ Nginx ุจู ุนููุงู Reverse Proxy ุงุณุชูุงุฏู ูโฺฉููุ ูุนูููุงู ุชูุธูุงุช ุขู ุจู ุตูุฑุช ุงุณุชุงุชฺฉ ุงุณุช. ุงู ุจุงุนุซ ูโุดูุฏ:

1. ุงฺฏุฑ ุณุฑูุณ ฺฉู ุฏุฑ ุชูุธูุงุช Nginx ุขูุฏูุ ุฏุฑ ุฏุณุชุฑุณ ูุจุงุดุฏุ Nginx ุจู ูุดฺฉู ุจุฎูุฑุฏ ุง ุจุงูุง ูุงุฏ.
2. ูุฑ ุจุงุฑ ฺฉู ุขุฏุฑุณ ุง ุชุนุฏุงุฏ ุณุฑูุณโูุง ุชุบุฑ ูโฺฉูุฏุ ูุงุฒ ุจู ูุฑุงุด ุฏุณุช ุชูุธูุงุช ู reload ฺฉุฑุฏู Nginx ุฏุงุฑู.
3. ููุงููฺฏ ุจู CI/CD ู load balancer ุจู ุณุฎุช ุงูุฌุงู ูโุดูุฏ.

---

## โ ุฑุงูโุญู: Service Discovery ุจุง Consul + ูุงูุจโุณุงุฒ ุจุง Consul Template

### ุงุฌุฒุง ุงุตู:

- **Consul**: ฺฉุดู ู ูฺฏูุฏุงุฑ ุงุทูุงุนุงุช ุณุฑูุณโูุง ุจู ุตูุฑุช ุฏุงูุงูฺฉ.
- **Consul Template**: ุชููุฏ ุฏุงูุงูฺฉ ูุงู ฺฉุงููฺฏ Nginx ุงุฒ ุฏุงุฏูโูุง Consul.
- **Nginx**: ุนูู ุจูโุนููุงู reverse proxy ุจู ุณูุช ุณุฑูุณโูุง ุซุจุชโุดุฏู ุฏุฑ Consul.
- **App (ูุซุงู)**: ฺฉ ุณุฑูุณ ุณุงุฏู ฺฉู ุฎูุฏุด ุฑุง ุจู Consul ุฑุฌุณุชุฑ ูโฺฉูุฏ.

---

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```
.
โโโ docker-compose.yml
โโโ nginx/
    โโโ nginx.conf              # ฺฉุงููฺฏ ุงุตู Nginx
    โโโ nginx.ctmpl             # ุชููพูุช ฺฉุงููฺฏ ฺฉู ุชูุณุท consul-template ูพุฑ ูโุดูุฏ
    โโโ templates/
        โโโ upstream.conf       # ูุงู ุชููุฏุดุฏู ุจุฑุง upstream
```

---

## โถ๏ธ ุงุฌุฑุง ูพุฑูฺู

```bash
docker compose up --build
```

- ุงูพูฺฉุดู ุฑู ูพูุฑุช 9000 ุงุฌุฑุง ูโุดูุฏ.
- Nginx ุฑู ูพูุฑุช 8080 ุจู ุนููุงู ูุฑูุฏ ุนูู ูโฺฉูุฏ.
- ุฎุฑูุฌ `http://localhost:8080` ุจุงุฏ ูุชู `hello from app` ุฑุง ูุดุงู ุฏูุฏ.

---

## โ๏ธ ุชูุธูุงุช ฺฉูุฏ

### nginx.ctmpl

```nginx
upstream backend {
  {{ range service "myapp" }}
  server {{ .Address }}:{{ .Port }};
  {{ end }}
}
```

ุงู ุชููพูุช ุชูุณุท `consul-template` ูพุฑ ุดุฏู ู upstream ุฏุงูุงูฺฉ ูโุณุงุฒุฏ.

---

## ๐ง ูุชุฌู

ุงู ุฑูุด:
- Nginx ุฑุง ุฏุฑ ุจุฑุงุจุฑ ุชุบุฑุงุช ููุงูู ูโฺฉูุฏ.
- Deploy ุฌุฏุฏ ุฑุง ุจุฏูู ูุงุฒ ุจู reload ุฏุณุช ูพุดุชุจุงู ูโฺฉูุฏ.
- ูพุงูโุง ุจุฑุง ุณุงุฎุชู ุฒุฑุณุงุฎุชโูุง ููุงุณโูพุฐุฑ microservice ูุฑุงูู ูโฺฉูุฏ.

